# 客户端部署

## 第一步：配置uwsgi

1. 添加配置文件uwsgi.ini至项目主目录，内容如下：

   ~~~python
   [uwsgi]
   
   http=0.0.0.0:5000
   
   callable = app
   
   chdir=/home/ubuntu/project/weather_client
   
   wsgi-file=flask_client.py
   
   process=3
   
   threads=2
   
   pidfile=uwsgi.pid
   
   daemonize=uwsgi.log
   
   master=true
   ~~~

2. 修改flask_client.py 文件的启动ip为127.0.0.1（限制外网访问）。

3. 启动uwsgi，验证是否成功。

   ~~~shell
   # 切换到项目目录
   sudo uwsgi --ini uwsgi.ini
   ~~~

   **验证：**浏览器打开url地址，查看页面是否可以正常显示。

## 第二步：配置nginx

1. 备份nginx配置文件/etc/nginx/sites-available/default

   ~~~shell
   sudo cp default default.bak_20200110
   ~~~

2. 修改配置文件default，修改内容如下（将如下内容替换到配置文件中的相同位置）：

   ~~~python
   server {
           listen 80 default_server;
           listen [::]:80 default_server;
   
           # SSL configuration
           #
           # listen 443 ssl default_server;
           # listen [::]:443 ssl default_server;
           #
           # Note: You should disable gzip for SSL traffic.
           # See: https://bugs.debian.org/773332
           #
           # Read up on ssl_ciphers to ensure a secure configuration.
           # See: https://bugs.debian.org/765782
           #
           # Self signed certs generated by the ssl-cert package
           # Don't use them in a production server!
           #
           # include snippets/snakeoil.conf;
   
           root /var/www/html;
   
           # Add index.php to the list if you are using PHP
           index index.html index.htm index.nginx-debian.html;
   
           server_name _;
   
           location / {
                   uwsgi_pass 127.0.0.1:5000;
                   include /etc/nginx/uwsgi_params;
                   # First attempt to serve request as file, then
                   # as directory, then fall back to displaying a 404.
                   #try_files $uri $uri/ =404;
           }
   
           location /static {
                   root /home/ubuntu/project/weather_client;
   }
   
           # pass PHP scripts to FastCGI server
           #
           #location ~ \.php$ {
           #       include snippets/fastcgi-php.conf;
           #
           #       # With php-fpm (or other unix sockets):
           #       fastcgi_pass unix:/var/run/php/php7.0-fpm.sock;
           #       # With php-cgi (or other tcp sockets):
           #       fastcgi_pass 127.0.0.1:9000;
           #}
   
           # deny access to .htaccess files, if Apache's document root
           # concurs with nginx's one
           #
           #location ~ /\.ht {
           #       deny all;
           #}
   }
   
   
   ~~~

3. 重启nginx

   ~~~shell
   sudo /etc/init.d/nginx restart
   ~~~

4. 修改项目目录下的uwsgi.ini配置文件

   ~~~python
   # 将http改为socket，修改ip
   socket=127.0.0.1:5000
   ~~~

5. 重启uwsgi

   ~~~shell
   # 在项目主目录下命令行执行以下两行命令
   sudo uwsgi --stop uwsgi.pid
   sudo uwsgi --ini uwsgi.ini
   ~~~

6. 浏览器打开url地址，验证页面是否可以正常打开。



# 服务端部署

## 第一步：配置uwsgi

1. 添加配置文件uwsgi.ini至项目主目录，内容如下：

   ~~~python
   [uwsgi]
   
   http=0.0.0.0:18000
   
   chdir=/home/ubuntu/project/weather_server
   
   wsgi-file=weather_server/wsgi.py
   
   process=3
   
   threads=2
   
   pidfile=uwsgi.pid
   
   daemonize=uwsgi.log
   
   master=true
   ~~~

2. 启动uwsgi，验证是否成功。

   ~~~shell
   # 切换到项目目录
   sudo uwsgi --ini uwsgi.ini
   ~~~

   **验证：**浏览器打开url地址，查看页面是否可以正常显示。



**问题：**遇到uwsgi默认python版本与系统指定默认版本不一致问题。

uwsgi默认的python版本是3.6.8，而系统早就手动改成3.6.5了，python3.6.8版本没有安装django，所以报导入包错误（没有包），花了半天的时间，想将uwsgi的默认版本改为3.6.5，发现python3.6.5的pip3没有安装uwsgi，在pip3安装uwsgi时出现报错，google搜索之后也没有解决，最后想了另外一个办法，直接给uwsgi默认的python3.6.8安装上相应的包（django2.1.8），问题就这样解决了。【其实在问题出现的时候，就应该先思考都有哪些解决方案，评估各个方案的困难程度和时间消耗，再去行动】